#!/bin/bash
# Post-installation script for oauth-caddy

set -e

echo "ğŸ”§ Configuring OAuth Caddy..."

# Create oauth2-proxy templates directory
mkdir -p /var/lib/oauth2-proxy/templates

# Set permissions on configuration files
chmod 644 /etc/caddy/Caddyfile.template
chmod 644 /etc/oauth2-proxy/*.template
chmod 755 /usr/local/bin/oauth-caddy-setup
chmod 755 /usr/bin/oauth2-proxy

# Create caddy log directory if it doesn't exist
mkdir -p /var/log/caddy
chown caddy:caddy /var/log/caddy 2>/dev/null || chown www-data:www-data /var/log/caddy

echo "âœ… OAuth Caddy configured successfully!"
echo "ğŸ“ Run 'oauth-caddy-setup --help' to see configuration options"
echo "ğŸ”§ Example: oauth-caddy-setup --domain example.com --email admin@example.com"

exit 0